<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>벡엔드 공부</title>
</head>
<body>
        <input type = "text" id="id">
        <input type = "password" id="password">
        <input type = "text" placeholder="닉" id= "nickname">
        <input type = "text" placeholder="폰" id= "phone">
        <button onclick="login()">로그인</button>
        <button onclick="naverlogin()">네이버로 로그인</button>
        <button onclick="location.href='SignUp'">회원가입</button>

        <button onclick="post()">post</button>
        <button onclick="get()">get</button>
        <button onclick="del()">delete</button>
        <button onclick="put()">put</button>
        <input type = "button" value="연결상태" onclick="elasticStatus()">
        <input type ="text" id="insertBox">
        <input type = "button" value="값 삽입" onclick="elasticInsert()">
        <input type ="text" id="searchBox">
        <input type = "button" value="값 검색" onclick="elasticSearch()">


<!--
        
        <div id="map" style="width:500px;height:400px;"></div>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=016738581bf8ff5fa9db3b6517ce07b4"></script>

        <script>
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
            mapOption = { 
                center: new kakao.maps.LatLng(37.4513039767043, 126.656937280079), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };

            var map = new kakao.maps.Map(mapContainer, mapOption);
            var positions = [
                {
                    content: '<div>프린트카페 인하대점</div>', 
                    latlng: new kakao.maps.LatLng(37.4517658731219, 126.656609457218)
                },
                {
                    content: '<div>프린트카페 인하대후문점</div>', 
                    latlng: new kakao.maps.LatLng(37.451811041938, 126.660643148828)
                },
                {
                    content: '<div>동문인쇄출판</div>',
                    latlng: new kakao.maps.LatLng(37.4516284345087, 126.655637580918)
                }
            ];

    var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 
        
    for (var i = 0; i < positions.length; i ++) {
        
        // 마커 이미지의 이미지 크기 입니다
        var imageSize = new kakao.maps.Size(24, 35); 
        
        // 마커 이미지를 생성합니다    
        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
        
        // 마커를 생성합니다
        var marker = new kakao.maps.Marker({
            map: map, // 마커를 표시할 지도
            position: positions[i].latlng, // 마커를 표시할 위치
            title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
            image : markerImage // 마커 이미지 
        });
        var infowindow = new kakao.maps.InfoWindow({
        content: positions[i].content // 인포윈도우에 표시할 내용
    });

    // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
    // 이벤트 리스너로는 클로저를 만들어 등록합니다 
    // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
    kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
    kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
}

function makeOverListener(map, marker, infowindow) {
    return function() {
        infowindow.open(map, marker);
    };
}

// 인포윈도우를 닫는 클로저를 만드는 함수입니다 
function makeOutListener(infowindow) {
    return function() {
        infowindow.close();
    };
}


        </script>
    -->

    <script>
    const login = () =>{

        var reqId = document.getElementById("id").value;
        var reqPwd = document.getElementById("password").value;
        var reqPhone = document.getElementById("phone").value;
        var reqNickname = document.getElementById("nickname").value;
        var token = localStorage.getItem("token");
        fetch("/auth/login", {
            "method" : "POST",
            "headers" : {
                //"auth" : localStorage.getItem("token"),
                "Content-Type" : "application/json"
            },
            "body" : JSON.stringify({
                "id" : reqId,
                "password" : reqPwd,
                //"phone_number" : reqPhone,
                //"nickname" : reqNickname,
              //"token" : localStorage.getItem("token")
            })
        })
        .then((response) => response.json())
        .then((result) =>{
            if(result.success){
                console.log(result);
                //localStorage.setItem("token", result.token);
                //location.href = "test";
            }
            else if(!result.success){
                alert(result.message);
            }

        })
        /*fetch("/login", {
                method : "POST",
                headers : {
                    "Content-Type" : "application/json",
                },
                body: JSON.stringify({
                    "id" : reqId,
                    "password" : reqPwd
                })
            })

            .then ((response) => response.json())
            .then ((login) =>{
                if(login.success == true){
                location.href="/modify";
                }
            })
            
            .catch((error) => {
                console.log(error);
            })*/
    }
    const naverlogin = () =>{

        fetch("/naverlogin", {
            method : "GET",
            headers : {
                "Content-Type" : "application/json"
            }

        })
        .then((result) => localStorage.setItem("token", result.access_token))
        .catch((err)=> console.log(err))
    }

    const elasticStatus = () =>{
            fetch('/elastic/status',)
            .then((response)=> response.json())
            .then((response) => console.log(response))
        }

    const elasticSearch = () =>{
        fetch("/elastic/search",{
            "method" : "POST",
            "headers" : {
                "Content-Type" : "application/json"
            },
            "body" : JSON.stringify({
                "name" : document.getElementById("searchBox").value
            })
        })
        .then((response) => response.json())
        .then(result => console.log(result))
    }
    </script>
    <script>
        const elasticInsert = () =>{
        fetch("/elastic",{
            "method" : "POST",
            "headers" : {
                "Content-Type" : "application/json"
            },
            "body" : JSON.stringify({
                "name" : document.getElementById("insertBox").value
            })
        })
        .then((response) => response.json())
        .then(result => console.log(result.success))
    }
        </script>
</body>
</html>